<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  
  <title>æœƒå“¡æŸ¥è©¢ç³»çµ± | XLAB Style</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">

  <style>
    :root {
      --font-family: 'Lexend', 'Noto Sans TC', sans-serif;
      --color-bg-dark: #020617;
      --color-text-main: #e5e7eb;
      --color-text-muted: #9ca3af;
      --color-primary: #38bdf8; /* Cyan */
      --color-secondary: #a855f7; /* Purple */
      --glass-bg: rgba(15, 23, 42, 0.8);
      --glass-border: rgba(148, 163, 184, 0.3);
      --input-bg: rgba(15, 23, 42, 0.6);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: var(--font-family);
      background:
        radial-gradient(circle at top, rgba(56,189,248,0.15), transparent 60%),
        radial-gradient(circle at bottom, rgba(168,85,247,0.12), transparent 60%),
        var(--color-bg-dark);
      color: var(--color-text-main);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      line-height: 1.6;
    }

    .app-container {
      width: 100%;
      max-width: 420px;
      padding: 24px;
    }

    .glass-card {
      background-color: var(--glass-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-radius: 20px;
      padding: 32px 24px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      transition: transform 0.3s ease, opacity 0.3s ease;
    }

    header {
      text-align: center;
      margin-bottom: 24px;
    }
    
    h2 {
      margin: 0;
      font-size: 1.5em;
      font-weight: 700;
      color: #f9fafb;
      letter-spacing: 0.05em;
    }
    
    .sub-title {
      font-size: 0.9em;
      color: var(--color-text-muted);
      margin-top: 8px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-size: 0.95em;
      font-weight: 500;
      color: var(--color-text-main);
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .input-group {
      margin-bottom: 20px;
    }

    input {
      width: 100%;
      padding: 14px 16px;
      background: var(--input-bg);
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      color: #fff;
      font-size: 1em;
      font-family: var(--font-family);
      transition: all 0.2s;
      outline: none;
    }

    input::placeholder {
      color: rgba(156, 163, 175, 0.6);
    }

    input:focus {
      border-color: var(--color-primary);
      box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.15);
      background: rgba(15, 23, 42, 0.9);
    }

    button.submit-btn {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
      color: #020617;
      font-size: 1.05em;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 4px 15px rgba(56, 189, 248, 0.4);
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
    }

    button.submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(56, 189, 248, 0.6);
    }

    button.submit-btn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
    }
    
    button.secondary-btn {
      margin-top: 24px;
      background: transparent;
      border: 1px solid var(--glass-border);
      color: var(--color-text-muted);
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 0.9em;
      transition: all 0.2s;
    }
    
    button.secondary-btn:hover {
      color: #fff;
      border-color: var(--color-text-muted);
      background: rgba(255,255,255,0.05);
    }

    #resultArea {
      display: none;
      text-align: center;
      animation: fadeIn 0.5s ease;
    }

    #welcomeText {
      font-size: 1.25em;
      margin-bottom: 16px;
      color: var(--color-primary);
    }

    #memberImage {
      width: 100%;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
      border: 1px solid var(--glass-border);
      margin-bottom: 8px;
    }

    .status-msg {
      text-align: center;
      margin-top: 16px;
      font-size: 0.9em;
      min-height: 20px;
    }
    .error { color: #ef4444; }
    .loading { color: var(--color-primary); }

    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 480px) {
      .app-container {
        padding: 16px;
      }
      .glass-card {
        padding: 24px 20px;
      }
    }
  </style>
</head>
<body>

  <div class="app-container">
    
    <div id="formContainer" class="glass-card">
      <header>
        <h2>æœƒå“¡è³‡æ–™æŸ¥è©¢</h2>
        <div class="sub-title">è«‹è¼¸å…¥æ‚¨çš„è¨»å†Šä¿¡ç®±ä»¥ç²å–æœƒå“¡å¡</div>
      </header>

      <form id="checkForm">
        <div class="input-group">
          <label for="email">
            <span class="material-symbols-outlined" style="font-size: 1.2em; color: var(--color-secondary);">mail</span>
            é›»å­ä¿¡ç®±
          </label>
          <input type="email" id="email" required placeholder="name@example.com">
        </div>

        <button type="submit" id="submitBtn" class="submit-btn">
          <span>æŸ¥è©¢æœƒå“¡å¡</span>
          <span class="material-symbols-outlined">arrow_forward</span>
        </button>
      </form>

      <div id="statusArea" class="status-msg"></div>
    </div>

    <div id="resultArea" class="glass-card">
      <header>
        <span class="material-symbols-outlined" style="font-size: 3em; color: #10b981; margin-bottom: 8px;">check_circle</span>
        <h2 id="welcomeText"></h2>
      </header>
      
      <img id="memberImage" src="" alt="æœƒå“¡å¡">
      
      <button onclick="location.reload()" class="secondary-btn">
        <span class="material-symbols-outlined" style="vertical-align: middle; font-size: 1.1em;">refresh</span>
        é‡æ–°æŸ¥è©¢
      </button>
    </div>

  </div>

  <script>
    // ğŸ”´ è«‹ç¢ºä¿é€™è£¡æ˜¯æ‚¨æ­£ç¢ºçš„ n8n Webhook URL ğŸ”´
    const N8N_WEBHOOK_URL = "https://ooschoolall.zeabur.app/webhook/check-member"; 

    const form = document.getElementById('checkForm');
    const submitBtn = document.getElementById('submitBtn');
    const statusArea = document.getElementById('statusArea');
    const formContainer = document.getElementById('formContainer');
    const resultArea = document.getElementById('resultArea');
    const welcomeText = document.getElementById('welcomeText');
    const memberImage = document.getElementById('memberImage');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // 1. åªæŠ“å– Emailï¼Œç§»é™¤ Name
      const email = document.getElementById('email').value.trim();

      // UI åˆ‡æ›è‡³è®€å–ç‹€æ…‹
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<div class="spinner"></div> æŸ¥è©¢ä¸­...';
      statusArea.innerHTML = '';
      statusArea.className = 'status-msg loading';

      try {
        const response = await fetch(N8N_WEBHOOK_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          // 2. é€™è£¡åªç™¼é€ email
          body: JSON.stringify({ email: email })
        });

        const data = await response.json();

        // æ¢å¾©æŒ‰éˆ•
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<span>æŸ¥è©¢æœƒå“¡å¡</span><span class="material-symbols-outlined">arrow_forward</span>';

        if (data.found) {
          // æˆåŠŸï¼šåˆ‡æ›ç•«é¢
          formContainer.style.display = 'none';
          resultArea.style.display = 'block';
          // data.name æ˜¯å¾ n8n (Google Sheets) å›å‚³çš„ï¼Œæ‰€ä»¥å°±ç®—è¼¸å…¥æ²’å¡«ï¼Œé€™è£¡é‚„æ˜¯æœƒé¡¯ç¤ºåå­—
          welcomeText.innerText = `${data.name} ä½ å¥½ï¼Œæ‚¨çš„é›»å­æœƒå“¡å¡`;
          memberImage.src = data.imageUrl;
        } else {
          // å¤±æ•—ï¼šé¡¯ç¤ºéŒ¯èª¤
          statusArea.innerText = "æ‰¾ä¸åˆ°æ­¤æœƒå“¡è³‡æ–™ï¼Œè«‹ç¢ºèªè¼¸å…¥æ˜¯å¦æ­£ç¢ºã€‚";
          statusArea.className = 'status-msg error';
          // æ–æ™ƒå‹•ç•«æç¤ºéŒ¯èª¤
          formContainer.animate([
            { transform: 'translateX(0)' },
            { transform: 'translateX(-10px)' },
            { transform: 'translateX(10px)' },
            { transform: 'translateX(0)' }
          ], { duration: 300 });
        }

      } catch (err) {
        console.error(err);
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<span>æŸ¥è©¢æœƒå“¡å¡</span><span class="material-symbols-outlined">arrow_forward</span>';
        statusArea.innerText = "ç³»çµ±é€£ç·šéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–ç¨å¾Œå†è©¦ã€‚";
        statusArea.className = 'status-msg error';
      }
    });
  </script>

</body>
</html>
